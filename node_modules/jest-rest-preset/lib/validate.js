"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.validate = void 0;
const ajv_1 = __importDefault(require("ajv"));
const utils_1 = require("./utils");
const config = utils_1.readConfig();
const ajvConfig = config.ajv;
exports.validate = (data, schema) => {
    const ajv = new ajv_1.default({ $data: true, ...ajvConfig });
    const valid = ajv.validate(schema, data);
    const ajvErrors = ajv.errors || [];
    let errorText = '';
    for (const error of ajvErrors) {
        if (errorText !== '') {
            errorText += ', ';
        }
        errorText += `data${error.dataPath} ${error.message}`;
        const params = error.params;
        const allowedValues = (params || {}).allowedValues;
        if (allowedValues) {
            errorText += ` ['${allowedValues.join(', ')}']`;
        }
    }
    return {
        errorText,
        valid: !!valid,
    };
};
